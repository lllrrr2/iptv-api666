name: Sync to Gitee

on:
  push:
    branches: [ main ]
    paths:
      - 'output/result.txt'
      - 'output/result.m3u'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout GitHub code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          
      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
      - name: Clone Gitee repository
        env:
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}
        run: |
          git clone https://${GITEE_TOKEN}@gitee.com/q8080713/tv.git gitee_repo
          
      - name: Sync result files to Gitee
        env:
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}
        run: |
          cd gitee_repo
          
          # åˆ›å»º iptv-api666 ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
          mkdir -p iptv-api666
          
          # å¤åˆ¶ result.txt å’Œ result.m3u åˆ° iptv-api666 ç›®å½•
          cp ../output/result.txt iptv-api666/result.txt
          cp ../output/result.m3u iptv-api666/result.m3u
          
          # æ·»åŠ å¹¶æäº¤æ›´æ”¹
          git add iptv-api666/result.txt iptv-api666/result.m3u
          git diff --cached --quiet || git commit -m "ğŸ”„ è‡ªåŠ¨æ›´æ–° IPTV æºæ–‡ä»¶"
          
          # æ¨é€åˆ° Giteeï¼ˆä½¿ç”¨ç”¨æˆ·åå’Œ tokenï¼‰
          git push https://q8080713:${GITEE_TOKEN}@gitee.com/q8080713/tv.git master
